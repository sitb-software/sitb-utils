configurations {
    provided {
        visible = false
    }

    testCompile {
        extendsFrom provided
    }
}

sourceSets {
    main {
        compileClasspath += configurations.provided
    }
}

idea {
    module {
        scopes.PROVIDED.plus += [configurations.provided]
    }
}